<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Revista Rio Pesquisa</title>
        <style>
            #revista.loading canvas {
                display: none;
            }

            #revista + progress {
                display: none;
            }

            #revista.loading + progress {
                position: absolute;
                width: 100%;
                height: 1pc;
                bottom: 0;
                left: 0;
                display: block;
            }
        </style>
        <script src="js/pdf.js"></script>
        <script src="js/jquery-3.5.1.min.js"></script>
        <script src="js/turn.min.js"></script>
        <script>
            window.addEventListener('load', function() {
                revista(document.getElementById('revista'))
            });
            function revista(elRevista) {
                pdfjsLib.GlobalWorkerOptions.workerSrc = 'js/pdf.worker.js';

                function renderPage(num, el) {
                    pdfDoc.getPage(num).then(function(page) {
                        var viewport = page.getViewport({
                            scale: 1,
                        });
                        el.canvas.height = viewport.height;
                        el.canvas.width = viewport.width;
                        var renderContext = {
                            canvasContext: el,
                            viewport: viewport,
                        };
                        var renderTask = page.render(renderContext);
                        renderTask.promise.then(function() {
                            if (num == 1)
                                num++;
                            document.querySelector('#revista + progress').value = num / pdfDoc.numPages;
                            if (num < pdfDoc.numPages) {
                                renderPage(num + 1, (document.createElement('canvas')).getContext('2d'));
                            } else if (num = pdfDoc.numPages) {
                                $("#revista").turn({
                                    display: 'double',
                                    width: el.canvas.width * 2,
                                    height: el.canvas.height,
                                    autoCenter: true,
                                    inclination: 50
                                });
                                document.getElementById('revista').className = '';
                            }
                            if (num == pdfDoc.numPages) {
                                elRevista.addEventListener('fullscreenchange', function() {
                                    $('#revista').turn('zoom', Math.min(window.innerWidth / elRevista.offsetWidth, window.innerHeight / elRevista.offsetHeight));
                                });
                                elRevista.addEventListener('click', function() {
                                    if (!document.fullscreenElement) {
                                        elRevista.requestFullscreen();
                                        $('#revista').turn('zoom', Math.min(window.innerWidth / elRevista.offsetWidth, window.innerHeight / elRevista.offsetHeight));
                                    }
                                });
                                $('#revista').turn('zoom', Math.min(window.innerWidth / elRevista.offsetWidth, window.innerHeight / elRevista.offsetHeight));
                            }
                        });
                    });
                    document.getElementById('revista').appendChild(el.canvas);
                }
                var pdfDoc;
                document.getElementById('revista').className = 'loading';
                var loadingTask = pdfjsLib.getDocument('pdf/rio_pesquisa_46_2019.pdf');
                loadingTask.promise.then(function(pdfDoc_) {
                    pdfDoc = pdfDoc_;
                    document.querySelector('#revista + progress').max = 1;
                    renderPage(1, (document.createElement('canvas')).getContext('2d'));
                });
            }
        </script>
    </head>
    <body style="margin:0;border:0;padding:0;width:100%;height:100%;overflow:hidden;background-color:gray;">
        <div style="margin:auto;width:100%">
            <div id="revista" style="background-color:gray;"></div>
            <progress id='pageLoad'>Carregando PÃ¡ginas </progress>
            <div>
    </body>
</html>
